local Hallucinations = game:GetService("Players")
local Yourself = Hallucinations.LocalPlayer

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Catsaken = Rayfield:CreateWindow({
   Name = "Catsaken",
   Icon = 0,
   LoadingTitle = "cats",
   LoadingSubtitle = "meow",
   ShowText = "",
   Theme = "Bloom",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = true,
   DisableBuildWarnings = true,
   ConfigurationSaving = {Enabled = true, FolderName = "cats", FileName = "catsaken"},
   KeySystem = false,
})

local Jason = game:GetService("ReplicatedStorage").Systems.Character.Game.Sprinting
local Noli = require(Jason)
local Elliot = {MaxStamina = 110, StaminaGain = 20, StaminaLoss = 10}
local ESP_ENABLED = false
local CHAMS = {}
local Killer = nil
local MIN_KILLER_HP = 200
local espConnections = {}
local function makeCham(char)
    if not char or not char:IsA("Model") then return end
    if CHAMS[char] then return end
    local highlight = Instance.new("Highlight")
    highlight.Name = "ZESP_CHAM"
    highlight.Adornee = char
    highlight.FillColor = Color3.new(1, 1, 1)
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 1
    highlight.Parent = game:GetService("CoreGui")
    CHAMS[char] = highlight
end
local function clearCham(char)
    if CHAMS[char] then
        CHAMS[char]:Destroy()
        CHAMS[char] = nil
    end
end
local function updateChamColor(plr)
    if not plr.Character or not CHAMS[plr.Character] then return end
    local hum = plr.Character:FindFirstChild("Humanoid")
    if not hum then return end
    if hum.Health >= MIN_KILLER_HP then
        Killer = plr
        CHAMS[plr.Character].FillColor = KillerColor
    else
        if plr ~= Killer then
            CHAMS[plr.Character].FillColor = SurvivorColor
        end
    end
end
local function refreshESP()
    if not ESP_ENABLED then return end
    for _, plr in pairs(Hallucinations:GetPlayers()) do
        if plr ~= Yourself and plr.Character then
            makeCham(plr.Character)
            updateChamColor(plr)
        end
    end
end
local function setupPlayer(plr)
    plr.CharacterAdded:Connect(function(char)
        task.wait(1)
        if ESP_ENABLED then
            makeCham(char)
            local hum = char:FindFirstChild("Humanoid")
            if hum then
                hum.HealthChanged:Connect(function()
                    updateChamColor(plr)
                end)
            end
            updateChamColor(plr)
        end
    end)
end
for _, plr in pairs(Hallucinations:GetPlayers()) do
    if plr ~= Yourself then
        setupPlayer(plr)
    end
end
Hallucinations.PlayerAdded:Connect(setupPlayer)
game:GetService("RunService").Heartbeat:Connect(function()
    if ESP_ENABLED then
        for char, _ in pairs(CHAMS) do
            if not char.Parent then clearCham(char) end
        end
        for _, plr in pairs(Hallucinations:GetPlayers()) do
            if plr ~= Yourself and plr.Character then
                updateChamColor(plr)
            end
        end
    end
end)
local function DoGenOrSmth()
    local IngameMapFolder = workspace:FindFirstChild("Map") and workspace.Map:FindFirstChild("Ingame")
    local SubMapFolder = IngameMapFolder and IngameMapFolder:FindFirstChild("Map")
    if SubMapFolder then
        for _, g in ipairs(SubMapFolder:GetChildren()) do
            if g.Name == "Generator" and g.Progress.Value < 100 then
                g.Remotes.RE:FireServer()
            end
        end
    end
end
local function JohnDoe()
   if Rayfield.Flags["infinite_stamina"].CurrentValue then
      Noli.StaminaLoss = 0
   else
      Noli.MaxStamina = tonumber(Rayfield.Flags["max_stamina"].CurrentValue) or Elliot.MaxStamina
      Noli.StaminaGain = tonumber(Rayfield.Flags["stamina_gain"].CurrentValue) or Elliot.StaminaGain
      Noli.StaminaLoss = tonumber(Rayfield.Flags["stamina_loss"].CurrentValue) or Elliot.StaminaLoss
   end
end
-- MAIN TAB --
local maintab = Catsaken:CreateTab("Main", 0)
local infstamina = maintab:CreateToggle({
   Name = "Infinite Stamina",
   CurrentValue = false,
   Flag = "infinite_stamina",
   Callback = function()
      JohnDoe()
   end,
})
local IMPORTANTLABEL = maintab:CreateSection("The 3 options under will not work if infinite stamina is on.")
local maxstamina = maintab:CreateInput({
   Name = "Max Stamina",
   CurrentValue = tostring(Elliot.MaxStamina),
   PlaceholderText = tostring(Elliot.MaxStamina),
   RemoveTextAfterFocusLost = false,
   Flag = "max_stamina",
   Callback = function(TextBoxValue)
      local num = tonumber(TextBoxValue)
      if num then
         Noli.MaxStamina = num
      end
   end,
})
local staminagain = maintab:CreateInput({
   Name = "Stamina Gain",
   CurrentValue = tostring(Elliot.StaminaGain),
   PlaceholderText = tostring(Elliot.StaminaGain),
   RemoveTextAfterFocusLost = false,
   Flag = "stamina_gain",
   Callback = function(TextBoxValue)
      local num = tonumber(TextBoxValue)
      if num then
         Noli.StaminaGain = num
      end
   end,
})
local staminaloss = maintab:CreateInput({
   Name = "Stamina Loss",
   CurrentValue = tostring(Elliot.StaminaLoss),
   PlaceholderText = tostring(Elliot.StaminaLoss),
   RemoveTextAfterFocusLost = false,
   Flag = "stamina_loss",
   Callback = function(TextBoxValue)
      local num = tonumber(TextBoxValue)
      if num then
         Noli.StaminaLoss = num
      end
   end,
})
-- VISUAL TAB --
local esptab = Catsaken:CreateTab("Visuals", 0)
local chamstoggleesp = esptab:CreateToggle({
   Name = "Chams",
   CurrentValue = false,
   Flag = "esp_toggle",
   Callback = function(val)
      ESP_ENABLED = val
      if ESP_ENABLED then
         refreshESP()
      else
         for char, _ in pairs(CHAMS) do
            clearCham(char)
         end
      end
   end,
})
local SurvivorsChams = esptab:CreateColorPicker({
    Name = "Survivor Chams Color",
    Color = Color3.fromRGB(255,255,255),
    Flag = "survivor_cham_picker",
    Callback = function(Value)
        SurvivorColor = Value
        refreshESP()
    end
})

local KillerChams = esptab:CreateColorPicker({
    Name = "Killer Chams Color",
    Color = Color3.fromRGB(255,255,255),
    Flag = "killer_cham_picker",
    Callback = function(Value)
        KillerColor = Value
        refreshESP()
    end
})
SurvivorColor = SurvivorsChams.Color
KillerColor = Color3.fromRGB(255,0,0)
-- GENS TAB --
local gentab = Catsaken:CreateTab("Generators", 0)
local GenCD = 4

local DoGeneratorButton = gentab:CreateButton({
    Name = "Do Generator",
    Callback = function()
        DoGenOrSmth()
    end
})
local AutoGenToggle = gentab:CreateToggle({
    Name = "Auto Generator",
    CurrentValue = false,
    Flag = "auto_gen",
    Callback = function(enabled)
        if espConnections["AutoGenLoop"] then
            espConnections["AutoGenLoop"]:Disconnect()
            espConnections["AutoGenLoop"] = nil
        end
        if enabled then
            espConnections["_AutoGenTimer"] = 0
            espConnections["AutoGenLoop"] = game:GetService("RunService").Heartbeat:Connect(function(delta)
                espConnections["_AutoGenTimer"] = espConnections["_AutoGenTimer"] + delta
                if espConnections["_AutoGenTimer"] >= GenCD then
                    espConnections["_AutoGenTimer"] = 0
                    DoGenOrSmth()
                end
            end)
        else
            espConnections["_AutoGenTimer"] = 0
        end
    end
})
local AutoGenSlider = gentab:CreateSlider({
    Name = "Generator Delay",
    Range = {2.5, 10},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = GenCD,
    Flag = "gen_delay_fuck_this_shit",
    Callback = function(value)
        GenCD = value
    end
})

-- OPTIONS TAB --
local optab = Catsaken:CreateTab("Options", 0)
local ihatethis = optab:CreateDropdown({
    Name = "Theme Changer",
    Options = {"Default","AmberGlow","Amethyst","Bloom","DarkBlue","Green","Light","Ocean","Serenity"},
    CurrentOption = {"Bloom"},
    MultipleOptions = false,
    Flag = "theme_ch4ng3r",
    Callback = function(sel)
        local id = type(sel) == "table" and sel[1] or sel
        if not id then return end
        local function try_method(obj, key, arg)
            if not obj or type(obj[key]) ~= "function" then return false end
            local fn = obj[key]
            local ok = pcall(fn, arg)
            if ok then return true end
            ok = pcall(fn, obj, arg)
            if ok then return true end
            return false
        end
        local ok = try_method(Catsaken, "ModifyTheme", id)
        if ok then return end
        ok = try_method(Rayfield, "ModifyTheme", id)
        if ok then return end
        local function find_theme(name)
            if Rayfield and type(Rayfield.Themes) == "table" then
                local t = Rayfield.Themes[name] or Rayfield.Themes[name:gsub("%s","")] or Rayfield.Themes[name:lower()]
                if t then return t end
            end
            if Catsaken and type(Catsaken.Themes) == "table" then
                local t = Catsaken.Themes[name] or Catsaken.Themes[name:gsub("%s","")] or Catsaken.Themes[name:lower()]
                if t then return t end
            end
            return nil
        end
        local themeTable = find_theme(id)
        if themeTable then
            ok = try_method(Catsaken, "ModifyTheme", themeTable)
            if ok then return end
            ok = try_method(Rayfield, "ModifyTheme", themeTable)
            if ok then return end
        end
    end,
})

Yourself.CharacterAdded:Connect(function()
   task.wait(1)
   JohnDoe()
end)
JohnDoe()
Rayfield:LoadConfiguration()
